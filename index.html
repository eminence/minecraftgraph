<html>
  <head>
    <title>Step Chart</title>
    <link type="text/css" rel="stylesheet" href="ex.css?3.2"/>
    <script type="text/javascript" src="https://andrewchin.net/vis/protovis-3.2/protovis-r3.2.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.5.min.js"></script>
    <script type="text/javascript" src="data.js"></script>
    <style type="text/css">

#fig {
  width: 430px;
  height: 225px;
}


    </style>
  </head>
  <body>
      <div style="width: 100%; background:#eee;">
          Mineral: <select onchange="selectMineral(this)">
                <option value="0">Air</option>
                <option value="1">Stone</option>
          </select>
      </div>
      <div id="center"><div id="fig">
    <script type="text/javascript+protovis">

var curGraph = 3;
var data = rawdata[curGraph];

/* Sizing and scales. */
var w = document.body.clientWidth - 80,
    h = 400,
    x = pv.Scale.linear(0, 128).range(0, w),
    y = pv.Scale.linear(0, pv.max(data)).range(0, h);

/* The root panel. */
var vis = new pv.Panel()
    .width(w)
    .height(h)
    .bottom(20)
    .left(40)
    .right(10)
    .top(5);

/* X-axis ticks. */
var xaxis = vis.add(pv.Rule)
    .data(x.ticks())
    .visible(function(d) d > 0)
    .left(x)
    .strokeStyle("#eee")
  .add(pv.Rule)
    .bottom(-5)
    .height(5)
    .strokeStyle("#000")
  .anchor("bottom").add(pv.Label)
    .text(x.tickFormat);

/* Y-axis ticks. */
var yaxis = vis.add(pv.Rule)
    .data(y.ticks(5))
    .bottom(y)
    .strokeStyle(function(d) d ? "#eee" : "#000");
var yaxisL = yaxis.anchor("left").add(pv.Label)
    .text(y.tickFormat);

/* The line. */
var l = vis.add(pv.Line)
    .data(data)
    .interpolate("basis")
    .left(function(d) x(this.index))
    .bottom(function(d) y(d))
    .lineWidth(3);

vis.render();

function selectMineral(e) {
    switchGraph(parseInt(e.value));
}

function switchGraph(x) {
    if (x < 0) x = curGraph;
    w = document.body.clientWidth - 80;
    vis.width(w);
    data = rawdata[x];
    y = pv.Scale.linear(0, pv.max(data)).range(0, h);
    x = pv.Scale.linear(0, 128).range(0, w);
    yaxis.data(y.ticks(5));
    yaxis.bottom(y);
    yaxisL.text(y.tickFormat);
    xaxis.left(x);
    xaxis.data(x.ticks());
    l.data(data);
    l.left(function(d) x(this.index))
    vis.render();
    //curGraph = x;
}

jQuery(window).resize(function() {
    switchGraph(-1);
        });

    </script>
  </div></div></body>
</html>
